macro(check_winsock)
  # dump(MINGW MINGW32 MINGW64 WIN32 WIN64 MSVC MSYS)
  if(WIN32 OR MSVC)
    check_library_exists(wsock32 select@20 "" HAVE_WSOCK32_LIB)
    if(HAVE_WSOCK32_LIB)
      set(LIBMSWSOCK wsock32)
    else(HAVE_WSOCK32_LIB)
      check_library_exists(mswsock select@20 "" HAVE_MSWSOCK_LIB)
      if(HAVE_MSWSOCK_LIB)
        set(LIBMSWSOCK mswsock)
      else(HAVE_MSWSOCK_LIB)
        check_library_exists(ws2_32 select@20 "" HAVE_WS2_32_LIB)
        if(HAVE_WS2_32_LIB)
          set(LIBMSWSOCK ws2_32)
        endif(HAVE_WS2_32_LIB)

      endif(HAVE_MSWSOCK_LIB)
    endif(HAVE_WSOCK32_LIB)

    check_library_exists(iphlpapi if_nametoindex "" HAVE_IPHLPAPI_LIB)
    if(HAVE_IPHLPAPI_LIB)
      set(LIBIPHLPAPI iphlpapi)
    endif(HAVE_IPHLPAPI_LIB)

    if(NOT LIBMSWSOCK)
      set(LIBMSWSOCK wsock32)
    endif(NOT LIBMSWSOCK)
    set(LIBMSWSOCK "${LIBMSWSOCK}" CACHE STRING "WinSock library name")
    if("${LIBMSWSOCK}" STREQUAL "")
      message(FATAL_ERROR "WinSock library not found")
    else("${LIBMSWSOCK}" STREQUAL "")
      message(STATUS "Microsoft Winsock library: ${LIBMSWSOCK}")
    endif("${LIBMSWSOCK}" STREQUAL "")
  endif(WIN32 OR MSVC)
endmacro(check_winsock)
