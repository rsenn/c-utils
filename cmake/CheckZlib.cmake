if(USE_ZLIB)
  message(CHECK_START "Checking for libz")
  if(NOT ZLIB_LIBRARIES)
    pkg_search_module(ZLIB zlib libz z QUIET)
    if(ZLIB_LIBRARIES)
      set(ZLIB_LIBRARY "${ZLIB_LIBRARIES}" CACHE FILEPATH "")
      set(ZLIB_FOUND TRUE)
    endif(ZLIB_LIBRARIES)
  endif(NOT ZLIB_LIBRARIES)

  if(NOT ZLIB_FOUND)
    find_library(ZLIB_LIBRARY z)
    if(ZLIB_LIBRARY)
      message(STATUS "Found libz: ${ZLIB_LIBRARY}")
      set(ZLIB_FOUND TRUE)
      if(NOT "${ZLIB_LIBRARY}" STREQUAL "")
        set(ZLIB_LIBRARIES "${ZLIB_LIBRARY}")
      endif(NOT "${ZLIB_LIBRARY}" STREQUAL "")
    endif(ZLIB_LIBRARY)
  endif(NOT ZLIB_FOUND)

  if(ZLIB_FOUND)
    message(CHECK_PASS "found")
  else(ZLIB_FOUND)
    message(CHECK_FAIL "NOT found")
  endif(ZLIB_FOUND)
else(USE_ZLIB)
  unset(ZLIB_LIBRARY CACHE)
endif(USE_ZLIB)
